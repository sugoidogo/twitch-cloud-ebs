var d=i=>{throw TypeError(i)};var o=(i,t,h)=>t.has(i)||d("Cannot "+h);var n=(i,t,h)=>(o(i,t,"read from private field"),h?h.call(i):t.get(i)),c=(i,t,h)=>t.has(i)?d("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,h),u=(i,t,h,e)=>(o(i,t,"write to private field"),e?e.call(i,h):t.set(i,h),h);var l,r,a,s,w=class{constructor(t,h=(e,f)=>globalThis.fetch(e,f)){c(this,l,new URL(import.meta.url).origin);c(this,r,null);c(this,a,null);c(this,s,null);u(this,s,h),u(this,r,t),t.getAccessTokenForUser(void 0).then(e=>caches.open(e.userId+"/"+t.clientId)).then(e=>u(this,a,e))}async fetch(t,h={}){if(t=new URL(t,n(this,l)),t.origin==n(this,l)){let e=await n(this,r).getAccessTokenForUser(void 0);h.headers||(h.headers={}),h.headers.authorization="OAuth "+e.accessToken}if("method"in h)switch(h.method){case"PUT":case"POST":{let e=await n(this,s).call(this,t,h);if(!e.ok)return e;let f=await new Request(t,h).blob();return n(this,a).put(t,new Response(f)),e}case"DELETE":{let e=await n(this,s).call(this,t,h);return e.ok&&n(this,a).delete(t),e}}return n(this,s).call(this,t,h).then(async e=>{if(e.status>=500)throw new Error(e.statusText+`
`+await e.text());return n(this,a).put(t,e.clone()),e}).catch(e=>(console.warn(e),n(this,a).match(t)))}};l=new WeakMap,r=new WeakMap,a=new WeakMap,s=new WeakMap;export{w as default};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiV2ViU3RvcmFnZS50cyJdLAogICJtYXBwaW5ncyI6ICIyVUFBQSxJQUFBQSxFQUFBQyxFQUFBQyxFQUFBQyxFQU9xQkMsRUFBckIsS0FBZ0MsQ0FlNUIsWUFBWUMsRUFBcURDLEVBQWlDLENBQUNDLEVBQVNDLElBQWtCLFdBQVcsTUFBTUQsRUFBU0MsQ0FBTyxFQUFJLENBYm5LQyxFQUFBLEtBQUFULEVBQVUsSUFBSSxJQUFJLFlBQVksR0FBRyxFQUFFLFFBQ25DUyxFQUFBLEtBQUFSLEVBQXVELE1BQ3ZEUSxFQUFBLEtBQUFQLEVBQWdCLE1BQ2hCTyxFQUFBLEtBQUFOLEVBQWtDLE1BVzlCTyxFQUFBLEtBQUtQLEVBQVNHLEdBQ2RJLEVBQUEsS0FBS1QsRUFBaUJJLEdBQ3RCQSxFQUFjLHNCQUFzQixNQUFTLEVBQ3hDLEtBQUtNLEdBQVMsT0FBTyxLQUFLQSxFQUFNLE9BQVMsSUFBTU4sRUFBYyxRQUFRLENBQUMsRUFDdEUsS0FBS08sR0FBU0YsRUFBQSxLQUFLUixFQUFTVSxFQUFLLENBQzFDLENBT0EsTUFBTSxNQUFNTCxFQUF3QkMsRUFBcUIsQ0FBQyxFQUFHLENBRXpELEdBREFELEVBQVcsSUFBSSxJQUFJQSxFQUFVTSxFQUFBLEtBQUtiLEVBQU8sRUFDckNPLEVBQVMsUUFBVU0sRUFBQSxLQUFLYixHQUFTLENBQ2pDLElBQU1XLEVBQVEsTUFBTUUsRUFBQSxLQUFLWixHQUFlLHNCQUFzQixNQUFTLEVBQ2xFTyxFQUFRLFVBQ1RBLEVBQVEsUUFBVSxDQUFDLEdBRXZCQSxFQUFRLFFBQVEsY0FBbUIsU0FBV0csRUFBTSxXQUN4RCxDQUNBLEdBQUksV0FBWUgsRUFDWixPQUFRQSxFQUFRLE9BQVEsQ0FDcEIsSUFBSyxNQUNMLElBQUssT0FBUSxDQUNULElBQU1NLEVBQVcsTUFBTUQsRUFBQSxLQUFLVixHQUFMLFVBQVlJLEVBQVVDLEdBQzdDLEdBQUksQ0FBQ00sRUFBUyxHQUNWLE9BQU9BLEVBRVgsSUFBTUMsRUFBTyxNQUFNLElBQUksUUFBUVIsRUFBVUMsQ0FBTyxFQUFFLEtBQUssRUFDdkQsT0FBQUssRUFBQSxLQUFLWCxHQUFPLElBQUlLLEVBQVUsSUFBSSxTQUFTUSxDQUFJLENBQUMsRUFDckNELENBQ1gsQ0FDQSxJQUFLLFNBQVUsQ0FDWCxJQUFNQSxFQUFXLE1BQU1ELEVBQUEsS0FBS1YsR0FBTCxVQUFZSSxFQUFVQyxHQUM3QyxPQUFLTSxFQUFTLElBR2RELEVBQUEsS0FBS1gsR0FBTyxPQUFPSyxDQUFRLEVBQ3BCTyxDQUNYLENBQ0osQ0FFSixPQUFPRCxFQUFBLEtBQUtWLEdBQUwsVUFBWUksRUFBVUMsR0FDeEIsS0FBSyxNQUFNTSxHQUFZLENBQ3BCLEdBQUlBLEVBQVMsUUFBVSxJQUNuQixNQUFNLElBQUksTUFBTUEsRUFBUyxXQUFhO0FBQUEsRUFBTyxNQUFNQSxFQUFTLEtBQUssQ0FBQyxFQUV0RSxPQUFBRCxFQUFBLEtBQUtYLEdBQU8sSUFBSUssRUFBVU8sRUFBUyxNQUFNLENBQUMsRUFDbkNBLENBQ1gsQ0FBQyxFQUFFLE1BQU1FLElBQ0wsUUFBUSxLQUFLQSxDQUFLLEVBQ1hILEVBQUEsS0FBS1gsR0FBTyxNQUFNSyxDQUFRLEVBRXpDLENBQ0osQ0FDSixFQXRFSVAsRUFBQSxZQUNBQyxFQUFBLFlBQ0FDLEVBQUEsWUFDQUMsRUFBQSIsCiAgIm5hbWVzIjogWyJfb3JpZ2luIiwgIl9hdXRoX3Byb3ZpZGVyIiwgIl9jYWNoZSIsICJfZmV0Y2giLCAiV2ViU3RvcmFnZSIsICJhdXRoX3Byb3ZpZGVyIiwgImZldGNoIiwgInJlc291cmNlIiwgIm9wdGlvbnMiLCAiX19wcml2YXRlQWRkIiwgIl9fcHJpdmF0ZVNldCIsICJ0b2tlbiIsICJjYWNoZSIsICJfX3ByaXZhdGVHZXQiLCAicmVzcG9uc2UiLCAiYmxvYiIsICJlcnJvciJdCn0K
